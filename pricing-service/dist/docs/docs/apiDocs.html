<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yadmanx Pricing Service API Documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --yadmanx-primary: #1a365d;
            --yadmanx-secondary: #2d3748;
            --yadmanx-accent: #3182ce;
            --yadmanx-success: #38a169;
            --yadmanx-warning: #d69e2e;
            --yadmanx-danger: #e53e3e;
            --yadmanx-light: #f7fafc;
            --yadmanx-dark: #1a202c;
            --border-radius: 8px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--yadmanx-dark);
            background-color: var(--yadmanx-light);
        }

        .header {
            background: linear-gradient(135deg, var(--yadmanx-primary), var(--yadmanx-accent));
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .nav {
            background: white;
            padding: 1rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav ul {
            display: flex;
            list-style: none;
            justify-content: center;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .nav a {
            text-decoration: none;
            color: var(--yadmanx-secondary);
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            transition: all 0.3s ease;
        }

        .nav a:hover {
            background-color: var(--yadmanx-accent);
            color: white;
        }

        .content {
            padding: 2rem 0;
        }

        .section {
            background: white;
            margin: 2rem 0;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .section h2 {
            color: var(--yadmanx-primary);
            font-size: 1.8rem;
            margin-bottom: 1rem;
            border-bottom: 3px solid var(--yadmanx-accent);
            padding-bottom: 0.5rem;
        }

        .section h3 {
            color: var(--yadmanx-secondary);
            font-size: 1.4rem;
            margin: 1.5rem 0 1rem 0;
        }

        .section h4 {
            color: var(--yadmanx-secondary);
            font-size: 1.2rem;
            margin: 1rem 0 0.5rem 0;
        }

        .endpoint {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: var(--border-radius);
            margin: 1rem 0;
            overflow: hidden;
        }

        .endpoint-header {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: white;
            border-bottom: 1px solid #e9ecef;
        }

        .method {
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85rem;
            margin-right: 1rem;
            min-width: 60px;
            text-align: center;
        }

        .method.get { background: var(--yadmanx-success); color: white; }
        .method.post { background: var(--yadmanx-accent); color: white; }
        .method.put { background: var(--yadmanx-warning); color: white; }
        .method.delete { background: var(--yadmanx-danger); color: white; }

        .endpoint-url {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 1rem;
            flex-grow: 1;
            color: var(--yadmanx-secondary);
        }

        .endpoint-body {
            padding: 1rem;
        }

        .endpoint-description {
            margin-bottom: 1rem;
            color: #666;
        }

        .tables-info {
            background: #e3f2fd;
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius);
            margin: 1rem 0;
            border-left: 4px solid var(--yadmanx-accent);
        }

        .tables-info h5 {
            color: var(--yadmanx-primary);
            margin-bottom: 0.5rem;
        }

        .table-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .table-tag {
            background: white;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.85rem;
            border: 1px solid #ccc;
            color: var(--yadmanx-secondary);
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: var(--border-radius);
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            margin: 1rem 0;
        }

        .parameter-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .parameter-table th,
        .parameter-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .parameter-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: var(--yadmanx-secondary);
        }

        .required {
            color: var(--yadmanx-danger);
            font-weight: 600;
        }

        .optional {
            color: #666;
        }

        .status-codes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .status-code {
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid #e9ecef;
        }

        .status-200 { border-left: 4px solid var(--yadmanx-success); }
        .status-400 { border-left: 4px solid var(--yadmanx-warning); }
        .status-404 { border-left: 4px solid var(--yadmanx-danger); }
        .status-500 { border-left: 4px solid var(--yadmanx-danger); }

        .database-schema {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .table-schema {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .table-schema-header {
            background: var(--yadmanx-primary);
            color: white;
            padding: 1rem;
            font-weight: 600;
        }

        .table-schema-body {
            padding: 1rem;
        }

        .field {
            padding: 0.5rem 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .field:last-child {
            border-bottom: none;
        }

        .field-name {
            font-family: monospace;
            font-weight: 600;
            color: var(--yadmanx-secondary);
        }

        .field-type {
            color: #666;
            font-size: 0.9rem;
        }

        .swagger-link {
            background: var(--yadmanx-accent);
            color: white;
            padding: 1rem 2rem;
            border-radius: var(--border-radius);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin: 2rem 0;
            transition: all 0.3s ease;
        }

        .swagger-link:hover {
            background: var(--yadmanx-primary);
            transform: translateY(-2px);
        }

        .highlight-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin: 2rem 0;
        }

        .highlight-box h3 {
            color: white;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .nav ul {
                flex-direction: column;
                gap: 0.5rem;
            }

            .endpoint-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .method {
                margin-bottom: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <h1><i class="fas fa-shield-alt"></i> yadmanx Pricing Service</h1>
            <p class="subtitle">Comprehensive Insurance Pricing API Documentation</p>
        </div>
    </header>

    <nav class="nav">
        <div class="container">
            <ul>
                <li><a href="#overview">Overview</a></li>
                <li><a href="#endpoints">API Endpoints</a></li>
                <li><a href="#database">Database Schema</a></li>
                <li><a href="#authentication">Authentication</a></li>
                <li><a href="#rate-limiting">Rate Limiting</a></li>
                <li><a href="#examples">Examples</a></li>
                <li><a href="#swagger">Interactive Docs</a></li>
            </ul>
        </div>
    </nav>

    <main class="content">
        <div class="container">
            <section id="overview" class="section">
                <h2><i class="fas fa-info-circle"></i> API Overview</h2>

                <div class="highlight-box">
                    <h3><i class="fas fa-rocket"></i> Welcome to yadmanx Pricing Service</h3>
                    <p>A robust, scalable microservice designed for multi-product insurance pricing calculations. This service handles real-time quote generation, risk assessment, and contribution validation for various insurance products.</p>
                </div>

                <h3>Key Features</h3>
                <ul>
                    <li><strong>Multi-Product Architecture:</strong> Currently supports Term Life Insurance with extensibility for Whole Life and Annuities</li>
                    <li><strong>Advanced Risk Assessment:</strong> Sophisticated underwriting engine with 8-tier risk classification</li>
                    <li><strong>Real-time Pricing:</strong> Sub-500ms response times with Redis caching</li>
                    <li><strong>Contribution Management:</strong> Flexible payment frequency validation and calculation</li>
                    <li><strong>Enterprise Ready:</strong> Built with rate limiting, monitoring, and health checks</li>
                </ul>

                <h3>Base URL</h3>
                <div class="code-block">http://localhost:3001</div>

                <h3>API Version</h3>
                <p>Current version: <strong>v1</strong> - All endpoints are prefixed with <code>/api/v1/</code></p>

                <h3>Response Format</h3>
                <p>All API responses return JSON with standard HTTP status codes. Successful responses include relevant data, while error responses include detailed error messages and validation details.</p>
            </section>

            <section id="endpoints" class="section">
                <h2><i class="fas fa-network-wired"></i> API Endpoints</h2>

                <div class="endpoint">
                    <div class="endpoint-header">
                        <span class="method get">GET</span>
                        <span class="endpoint-url">/api/v1/health</span>
                    </div>
                    <div class="endpoint-body">
                        <p class="endpoint-description">Quick health check endpoint optimized for load balancers and monitoring systems. Returns basic service status and uptime information.</p>

                        <div class="tables-info">
                            <h5><i class="fas fa-database"></i> Database Tables Used:</h5>
                            <div class="table-list">
                                <span class="table-tag">None (Memory-based check)</span>
                            </div>
                        </div>

                        <h4>Response Example:</h4>
                        <div class="code-block">{
  "status": "healthy",
  "timestamp": "2025-01-15T10:30:45.123Z",
  "uptime": 3600.15,
  "version": "1.0.0",
  "environment": "production"
}</div>

                        <div class="status-codes">
                            <div class="status-code status-200">
                                <strong>200 OK:</strong> Service is healthy and operational
                            </div>
                            <div class="status-code status-500">
                                <strong>503 Service Unavailable:</strong> Service is degraded or unavailable
                            </div>
                        </div>
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-header">
                        <span class="method get">GET</span>
                        <span class="endpoint-url">/api/v1/health/deep</span>
                    </div>
                    <div class="endpoint-body">
                        <p class="endpoint-description">Comprehensive health check that validates connectivity to all dependent services including PostgreSQL database, Redis cache, and feature flag configuration.</p>

                        <div class="tables-info">
                            <h5><i class="fas fa-database"></i> Database Tables Used:</h5>
                            <div class="table-list">
                                <span class="table-tag">products</span>
                                <span class="table-tag">rate_tables</span>
                            </div>
                        </div>

                        <h4>Response Example:</h4>
                        <div class="code-block">{
  "status": "healthy",
  "timestamp": "2025-01-15T10:30:45.123Z",
  "uptime": 3600.15,
  "version": "1.0.0",
  "environment": "production",
  "checks": {
    "database": {
      "status": "healthy",
      "responseTime": 15.3
    },
    "redis": {
      "status": "healthy",
      "responseTime": 2.1
    },
    "featureFlags": {
      "status": "healthy",
      "enabledProducts": ["term_life"]
    }
  }
}</div>

                        <div class="status-codes">
                            <div class="status-code status-200">
                                <strong>200 OK:</strong> All systems operational
                            </div>
                            <div class="status-code status-500">
                                <strong>503 Service Unavailable:</strong> One or more dependent services are down
                            </div>
                        </div>
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-header">
                        <span class="method post">POST</span>
                        <span class="endpoint-url">/api/v1/quotes/calculate</span>
                    </div>
                    <div class="endpoint-body">
                        <p class="endpoint-description">Core endpoint for insurance quote calculation. Processes applicant information, performs risk assessment, calculates premiums, and returns comprehensive quote details with eligibility flags.</p>

                        <div class="tables-info">
                            <h5><i class="fas fa-database"></i> Database Tables Used:</h5>
                            <div class="table-list">
                                <span class="table-tag">quotes</span>
                                <span class="table-tag">products</span>
                                <span class="table-tag">rate_tables</span>
                            </div>
                        </div>

                        <h4>Request Parameters:</h4>
                        <table class="parameter-table">
                            <thead>
                                <tr>
                                    <th>Field</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>productType</code></td>
                                    <td>string</td>
                                    <td class="required">Required</td>
                                    <td>Insurance product type: "term_life", "whole_life", "annuity"</td>
                                </tr>
                                <tr>
                                    <td><code>applicant.gender</code></td>
                                    <td>string</td>
                                    <td class="required">Required</td>
                                    <td>Applicant gender: "Male" or "Female"</td>
                                </tr>
                                <tr>
                                    <td><code>applicant.birthDate</code></td>
                                    <td>string</td>
                                    <td class="required">Required</td>
                                    <td>Birth date in YYYY-MM-DD format</td>
                                </tr>
                                <tr>
                                    <td><code>applicant.height</code></td>
                                    <td>number</td>
                                    <td class="required">Required</td>
                                    <td>Height in centimeters (120-250)</td>
                                </tr>
                                <tr>
                                    <td><code>applicant.weight</code></td>
                                    <td>number</td>
                                    <td class="required">Required</td>
                                    <td>Weight in kilograms (35-200)</td>
                                </tr>
                                <tr>
                                    <td><code>applicant.city</code></td>
                                    <td>string</td>
                                    <td class="required">Required</td>
                                    <td>City of residence</td>
                                </tr>
                                <tr>
                                    <td><code>applicant.usesNicotine</code></td>
                                    <td>boolean</td>
                                    <td class="required">Required</td>
                                    <td>Whether applicant uses nicotine products</td>
                                </tr>
                                <tr>
                                    <td><code>policy.termLength</code></td>
                                    <td>number</td>
                                    <td class="required">Required</td>
                                    <td>Term length in years (10 or 20 for term life)</td>
                                </tr>
                                <tr>
                                    <td><code>policy.coverageAmount</code></td>
                                    <td>number</td>
                                    <td class="required">Required</td>
                                    <td>Coverage amount in USD ($250,000 - $1,500,000)</td>
                                </tr>
                            </tbody>
                        </table>

                        <h4>Request Example:</h4>
                        <div class="code-block">{
  "productType": "term_life",
  "applicant": {
    "gender": "Male",
    "birthDate": "1985-06-15",
    "height": 180,
    "weight": 80,
    "city": "Casablanca",
    "usesNicotine": false
  },
  "policy": {
    "termLength": 20,
    "coverageAmount": 500000
  }
}</div>

                        <h4>Response Example:</h4>
                        <div class="code-block">{
  "quote": {
    "quoteId": "quote_term_1703174245123_a1b2c3",
    "productType": "term_life",
    "pricing": {
      "monthlyPremium": 120.54,
      "annualPremium": 1446.51
    },
    "riskAssessment": {
      "riskClass": "SuperPreferredPlus",
      "bmi": 24.7,
      "age": 40,
      "riskFactors": []
    },
    "eligibilityFlags": {
      "wouldDeclinePostUnderwriting": false,
      "requiresAdditionalUnderwriting": false,
      "declineReasons": []
    },
    "createdAt": "2025-01-15T10:30:45.123Z",
    "expiresAt": "2025-02-14T10:30:45.123Z"
  }
}</div>

                        <div class="status-codes">
                            <div class="status-code status-200">
                                <strong>200 OK:</strong> Quote calculated successfully
                            </div>
                            <div class="status-code status-400">
                                <strong>400 Bad Request:</strong> Invalid request parameters or validation failed
                            </div>
                            <div class="status-code status-500">
                                <strong>500 Internal Server Error:</strong> Quote calculation failed due to system error
                            </div>
                        </div>
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-header">
                        <span class="method get">GET</span>
                        <span class="endpoint-url">/api/v1/quotes/{quoteId}</span>
                    </div>
                    <div class="endpoint-body">
                        <p class="endpoint-description">Retrieves a previously calculated quote by its unique identifier. Useful for quote management and retrieval systems.</p>

                        <div class="tables-info">
                            <h5><i class="fas fa-database"></i> Database Tables Used:</h5>
                            <div class="table-list">
                                <span class="table-tag">quotes</span>
                            </div>
                        </div>

                        <h4>Path Parameters:</h4>
                        <table class="parameter-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>quoteId</code></td>
                                    <td>string</td>
                                    <td>Unique quote identifier returned from quote calculation</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="status-codes">
                            <div class="status-code status-200">
                                <strong>200 OK:</strong> Quote retrieved successfully
                            </div>
                            <div class="status-code status-404">
                                <strong>404 Not Found:</strong> Quote not found or invalid quote ID
                            </div>
                            <div class="status-code status-400">
                                <strong>410 Gone:</strong> Quote has expired (30-day expiration policy)
                            </div>
                        </div>
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-header">
                        <span class="method get">GET</span>
                        <span class="endpoint-url">/api/v1/products</span>
                    </div>
                    <div class="endpoint-body">
                        <p class="endpoint-description">Retrieves list of all available insurance products with their configurations. Respects feature flag settings to only return enabled products.</p>

                        <div class="tables-info">
                            <h5><i class="fas fa-database"></i> Database Tables Used:</h5>
                            <div class="table-list">
                                <span class="table-tag">products</span>
                            </div>
                        </div>

                        <h4>Response Example:</h4>
                        <div class="code-block">{
  "products": [
    {
      "product_type": "term_life",
      "display_name": "Term Life Insurance",
      "configuration": {
        "terms": [10, 20],
        "min_coverage": 250000,
        "max_coverage": 1500000,
        "age_min": 18,
        "age_max": 75
      },
      "is_active": true
    }
  ]
}</div>

                        <div class="status-codes">
                            <div class="status-code status-200">
                                <strong>200 OK:</strong> Products retrieved successfully
                            </div>
                        </div>
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-header">
                        <span class="method get">GET</span>
                        <span class="endpoint-url">/api/v1/products/{productType}</span>
                    </div>
                    <div class="endpoint-body">
                        <p class="endpoint-description">Retrieves detailed configuration for a specific product type including coverage limits, age restrictions, and available options.</p>

                        <div class="tables-info">
                            <h5><i class="fas fa-database"></i> Database Tables Used:</h5>
                            <div class="table-list">
                                <span class="table-tag">products</span>
                            </div>
                        </div>

                        <h4>Path Parameters:</h4>
                        <table class="parameter-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>productType</code></td>
                                    <td>string</td>
                                    <td>Product type: "term_life", "whole_life", or "annuity"</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="status-codes">
                            <div class="status-code status-200">
                                <strong>200 OK:</strong> Product configuration retrieved
                            </div>
                            <div class="status-code status-404">
                                <strong>404 Not Found:</strong> Product type not found
                            </div>
                            <div class="status-code status-400">
                                <strong>403 Forbidden:</strong> Product disabled by feature flag
                            </div>
                        </div>
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-header">
                        <span class="method post">POST</span>
                        <span class="endpoint-url">/api/v1/contributions/validate</span>
                    </div>
                    <div class="endpoint-body">
                        <p class="endpoint-description">Validates contribution amounts based on payment frequency and calculates equivalent amounts. Enforces minimum contribution requirements and business rules.</p>

                        <div class="tables-info">
                            <h5><i class="fas fa-database"></i> Database Tables Used:</h5>
                            <div class="table-list">
                                <span class="table-tag">None (Business logic validation)</span>
                            </div>
                        </div>

                        <h4>Request Parameters:</h4>
                        <table class="parameter-table">
                            <thead>
                                <tr>
                                    <th>Field</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>amount</code></td>
                                    <td>number</td>
                                    <td class="required">Required</td>
                                    <td>Contribution amount in MAD</td>
                                </tr>
                                <tr>
                                    <td><code>frequency</code></td>
                                    <td>string</td>
                                    <td class="required">Required</td>
                                    <td>Payment frequency: "monthly", "quarterly", "bi-annual", "annual"</td>
                                </tr>
                            </tbody>
                        </table>

                        <h4>Minimum Contribution Requirements:</h4>
                        <ul>
                            <li><strong>Monthly:</strong> 250 MAD</li>
                            <li><strong>Quarterly:</strong> 750 MAD</li>
                            <li><strong>Bi-annual:</strong> 1,500 MAD</li>
                            <li><strong>Annual:</strong> 3,000 MAD</li>
                        </ul>

                        <h4>Request Example:</h4>
                        <div class="code-block">{
  "amount": 500,
  "frequency": "monthly"
}</div>

                        <h4>Response Example:</h4>
                        <div class="code-block">{
  "validation": {
    "isValid": true,
    "monthlyEquivalent": 500,
    "annualTotal": 6000
  },
  "timestamp": "2025-01-15T10:30:45.123Z"
}</div>

                        <div class="status-codes">
                            <div class="status-code status-200">
                                <strong>200 OK:</strong> Validation completed successfully
                            </div>
                            <div class="status-code status-400">
                                <strong>400 Bad Request:</strong> Invalid amount or frequency
                            </div>
                        </div>
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-header">
                        <span class="method get">GET</span>
                        <span class="endpoint-url">/api/v1/metrics</span>
                    </div>
                    <div class="endpoint-body">
                        <p class="endpoint-description">Prometheus-formatted metrics endpoint for monitoring and observability. Includes request counts, response times, and business metrics.</p>

                        <div class="tables-info">
                            <h5><i class="fas fa-database"></i> Database Tables Used:</h5>
                            <div class="table-list">
                                <span class="table-tag">None (Metrics collection)</span>
                            </div>
                        </div>

                        <h4>Available Metrics:</h4>
                        <ul>
                            <li><code>pricing_service_quotes_generated_total</code> - Total quotes generated by product type and risk class</li>
                            <li><code>pricing_service_request_duration_seconds</code> - Request duration histogram</li>
                            <li><code>pricing_service_cache_hits_total</code> - Redis cache hit/miss counters</li>
                            <li><code>pricing_service_database_queries_total</code> - Database query counters</li>
                        </ul>

                        <div class="status-codes">
                            <div class="status-code status-200">
                                <strong>200 OK:</strong> Metrics retrieved successfully (text/plain format)
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="database" class="section">
                <h2><i class="fas fa-database"></i> Database Schema</h2>

                <p>The yadmanx Pricing Service uses PostgreSQL as its primary database with a well-structured schema designed for multi-product insurance operations.</p>

                <div class="database-schema">
                    <div class="table-schema">
                        <div class="table-schema-header">
                            <i class="fas fa-table"></i> products
                        </div>
                        <div class="table-schema-body">
                            <p><strong>Purpose:</strong> Stores product configurations and feature flag controls</p>
                            <div class="field">
                                <div class="field-name">product_type</div>
                                <div class="field-type">VARCHAR(50) PRIMARY KEY</div>
                            </div>
                            <div class="field">
                                <div class="field-name">display_name</div>
                                <div class="field-type">VARCHAR(100) NOT NULL</div>
                            </div>
                            <div class="field">
                                <div class="field-name">configuration</div>
                                <div class="field-type">JSONB NOT NULL</div>
                            </div>
                            <div class="field">
                                <div class="field-name">is_active</div>
                                <div class="field-type">BOOLEAN DEFAULT true</div>
                            </div>
                            <div class="field">
                                <div class="field-name">created_at</div>
                                <div class="field-type">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</div>
                            </div>
                            <div class="field">
                                <div class="field-name">updated_at</div>
                                <div class="field-type">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-schema">
                        <div class="table-schema-header">
                            <i class="fas fa-table"></i> rate_tables
                        </div>
                        <div class="table-schema-body">
                            <p><strong>Purpose:</strong> Stores actuarial rates for pricing calculations</p>
                            <div class="field">
                                <div class="field-name">id</div>
                                <div class="field-type">SERIAL PRIMARY KEY</div>
                            </div>
                            <div class="field">
                                <div class="field-name">product_type</div>
                                <div class="field-type">VARCHAR(50) REFERENCES products</div>
                            </div>
                            <div class="field">
                                <div class="field-name">risk_class</div>
                                <div class="field-type">VARCHAR(50) NOT NULL</div>
                            </div>
                            <div class="field">
                                <div class="field-name">gender</div>
                                <div class="field-type">VARCHAR(10) NOT NULL</div>
                            </div>
                            <div class="field">
                                <div class="field-name">age_min</div>
                                <div class="field-type">INTEGER NOT NULL</div>
                            </div>
                            <div class="field">
                                <div class="field-name">age_max</div>
                                <div class="field-type">INTEGER NOT NULL</div>
                            </div>
                            <div class="field">
                                <div class="field-name">term_length</div>
                                <div class="field-type">INTEGER</div>
                            </div>
                            <div class="field">
                                <div class="field-name">rate_per_thousand</div>
                                <div class="field-type">DECIMAL(10,4) NOT NULL</div>
                            </div>
                            <div class="field">
                                <div class="field-name">effective_date</div>
                                <div class="field-type">DATE NOT NULL DEFAULT CURRENT_DATE</div>
                            </div>
                            <div class="field">
                                <div class="field-name">expiry_date</div>
                                <div class="field-type">DATE</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-schema">
                        <div class="table-schema-header">
                            <i class="fas fa-table"></i> quotes
                        </div>
                        <div class="table-schema-body">
                            <p><strong>Purpose:</strong> Stores generated quotes with full calculation details</p>
                            <div class="field">
                                <div class="field-name">quote_id</div>
                                <div class="field-type">VARCHAR(50) PRIMARY KEY</div>
                            </div>
                            <div class="field">
                                <div class="field-name">product_type</div>
                                <div class="field-type">VARCHAR(50) NOT NULL</div>
                            </div>
                            <div class="field">
                                <div class="field-name">applicant_data</div>
                                <div class="field-type">JSONB NOT NULL</div>
                            </div>
                            <div class="field">
                                <div class="field-name">pricing_result</div>
                                <div class="field-type">JSONB NOT NULL</div>
                            </div>
                            <div class="field">
                                <div class="field-name">eligibility_flags</div>
                                <div class="field-type">JSONB NOT NULL</div>
                            </div>
                            <div class="field">
                                <div class="field-name">created_at</div>
                                <div class="field-type">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</div>
                            </div>
                            <div class="field">
                                <div class="field-name">expires_at</div>
                                <div class="field-type">TIMESTAMP NOT NULL</div>
                            </div>
                        </div>
                    </div>
                </div>

                <h3>Key Relationships</h3>
                <ul>
                    <li><strong>products â†’ rate_tables:</strong> One-to-many relationship where each product can have multiple rate entries for different risk classes, ages, and terms</li>
                    <li><strong>quotes:</strong> Independent table that stores complete quote snapshots with references to product types</li>
                </ul>

                <h3>Indexing Strategy</h3>
                <ul>
                    <li><strong>rate_tables:</strong> Composite index on (product_type, risk_class, gender, age_min, age_max, term_length) for fast rate lookups</li>
                    <li><strong>quotes:</strong> Indexes on expires_at, product_type, and created_at for efficient cleanup and reporting</li>
                </ul>
            </section>

            <section id="authentication" class="section">
                <h2><i class="fas fa-lock"></i> Authentication</h2>

                <p>Currently, the yadmanx Pricing Service operates in development mode without authentication requirements. For production deployments, the following authentication mechanisms are recommended:</p>

                <h3>Recommended Authentication Methods</h3>
                <ul>
                    <li><strong>API Key Authentication:</strong> Simple header-based authentication for service-to-service communication</li>
                    <li><strong>JWT Tokens:</strong> Stateless authentication with configurable expiration times</li>
                    <li><strong>mTLS:</strong> Certificate-based authentication for high-security environments</li>
                </ul>

                <div class="code-block"># Example API Key Usage (Future)
curl -H "Authorization: Bearer your-api-key" \
     -H "Content-Type: application/json" \
     http://localhost:3001/api/v1/quotes/calculate</div>
            </section>

            <section id="rate-limiting" class="section">
                <h2><i class="fas fa-tachometer-alt"></i> Rate Limiting</h2>

                <p>The service implements intelligent rate limiting to ensure fair usage and system stability:</p>

                <h3>Rate Limit Configuration</h3>
                <table class="parameter-table">
                    <thead>
                        <tr>
                            <th>Endpoint</th>
                            <th>Limit</th>
                            <th>Window</th>
                            <th>Scope</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>/api/v1/quotes/calculate</code></td>
                            <td>100 requests</td>
                            <td>15 minutes</td>
                            <td>Per IP address</td>
                        </tr>
                        <tr>
                            <td><code>/api/v1/contributions/validate</code></td>
                            <td>200 requests</td>
                            <td>15 minutes</td>
                            <td>Per IP address</td>
                        </tr>
                        <tr>
                            <td>Other endpoints</td>
                            <td>1000 requests</td>
                            <td>15 minutes</td>
                            <td>Per IP address</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Rate Limit Headers</h3>
                <p>All responses include rate limiting information in headers:</p>
                <div class="code-block">X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1642781234</div>

                <h3>Rate Limit Exceeded Response</h3>
                <div class="code-block">{
  "error": "Too Many Requests",
  "message": "Rate limit exceeded. Please try again later.",
  "retryAfter": 900
}</div>
            </section>

            <section id="examples" class="section">
                <h2><i class="fas fa-code"></i> Usage Examples</h2>

                <h3>Complete Quote Calculation Flow</h3>
                <div class="code-block"># Step 1: Get available products
curl -X GET "http://localhost:3001/api/v1/products" \
     -H "Content-Type: application/json"

# Step 2: Calculate quote
curl -X POST "http://localhost:3001/api/v1/quotes/calculate" \
     -H "Content-Type: application/json" \
     -d '{
       "productType": "term_life",
       "applicant": {
         "gender": "Female",
         "birthDate": "1990-03-15",
         "height": 165,
         "weight": 58,
         "city": "Rabat",
         "usesNicotine": false
       },
       "policy": {
         "termLength": 20,
         "coverageAmount": 750000
       }
     }'

# Step 3: Validate contribution
curl -X POST "http://localhost:3001/api/v1/contributions/validate" \
     -H "Content-Type: application/json" \
     -d '{
       "amount": 1000,
       "frequency": "quarterly"
     }'

# Step 4: Retrieve quote later
curl -X GET "http://localhost:3001/api/v1/quotes/quote_term_1703174245123_a1b2c3" \
     -H "Content-Type: application/json"</div>

                <h3>JavaScript SDK Example</h3>
                <div class="code-block">// Example using fetch API
const calculateQuote = async (quoteRequest) => {
  try {
    const response = await fetch('http://localhost:3001/api/v1/quotes/calculate', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(quoteRequest)
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const quote = await response.json();
    console.log('Quote calculated:', quote);
    return quote;
  } catch (error) {
    console.error('Quote calculation failed:', error);
    throw error;
  }
};

// Usage
const quoteRequest = {
  productType: 'term_life',
  applicant: {
    gender: 'Male',
    birthDate: '1985-06-15',
    height: 180,
    weight: 80,
    city: 'Casablanca',
    usesNicotine: false
  },
  policy: {
    termLength: 20,
    coverageAmount: 500000
  }
};

calculateQuote(quoteRequest);</div>

                <h3>Error Handling Best Practices</h3>
                <div class="code-block">const handleQuoteCalculation = async (request) => {
  try {
    const response = await fetch('/api/v1/quotes/calculate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(request)
    });

    const data = await response.json();

    if (!response.ok) {
      // Handle validation errors
      if (response.status === 400 && data.details) {
        data.details.forEach(error => {
          console.error(`${error.field}: ${error.message}`);
        });
      }

      // Handle rate limiting
      if (response.status === 429) {
        const retryAfter = response.headers.get('Retry-After');
        console.log(`Rate limited. Retry after ${retryAfter} seconds`);
      }

      throw new Error(data.message || 'Quote calculation failed');
    }

    return data;
  } catch (error) {
    console.error('Quote calculation error:', error);
    throw error;
  }
};</div>
            </section>

            <section id="swagger" class="section">
                <h2><i class="fas fa-tools"></i> Interactive API Documentation</h2>

                <p>For interactive API testing and detailed OpenAPI specifications, visit our Swagger UI interface:</p>

                <a href="/api/docs" class="swagger-link">
                    <i class="fas fa-external-link-alt"></i>
                    Open Interactive API Documentation
                </a>

                <h3>Additional Resources</h3>
                <ul>
                    <li><strong>OpenAPI Specification:</strong> Available in JSON format at <code>/api/docs/swagger.json</code></li>
                    <li><strong>Postman Collection:</strong> Import our API endpoints directly into Postman</li>
                    <li><strong>SDK Generation:</strong> Use the OpenAPI spec to generate SDKs in your preferred language</li>
                </ul>

                <h3>Support</h3>
                <p>For technical support, feature requests, or bug reports, please contact the yadmanx development team.</p>

                <div class="highlight-box">
                    <h3><i class="fas fa-heart"></i> Thank you for using yadmanx Pricing Service</h3>
                    <p>This documentation is continuously updated to reflect the latest API changes and improvements. For the most current information, always refer to this documentation and the interactive Swagger interface.</p>
                </div>
            </section>
        </div>
    </main>

    <script>
        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Highlight current section in navigation
        const observerOptions = {
            root: null,
            rootMargin: '-20% 0px -80% 0px',
            threshold: 0
        };

        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const currentId = entry.target.id;
                    document.querySelectorAll('.nav a').forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === `#${currentId}`) {
                            link.classList.add('active');
                        }
                    });
                }
            });
        }, observerOptions);

        document.querySelectorAll('section[id]').forEach(section => {
            observer.observe(section);
        });
    </script>
</body>
</html>