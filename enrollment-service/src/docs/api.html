<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yadmanx Enrollment Service API Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #1a202c;
            background-color: #f7fafc;
        }
        .header {
            background: linear-gradient(135deg, #1a365d, #3182ce);
            color: white;
            padding: 2rem 0;
            text-align: center;
        }
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        .section {
            background: white;
            margin: 2rem 0;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #1a365d;
            margin-bottom: 1rem;
            border-bottom: 2px solid #3182ce;
            padding-bottom: 0.5rem;
        }
        h3 {
            color: #2d3748;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
        }
        .endpoint {
            margin: 1.5rem 0;
            padding: 1rem;
            background: #f7fafc;
            border-left: 4px solid #3182ce;
        }
        .method {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: bold;
            margin-right: 0.5rem;
        }
        .post { background: #38a169; color: white; }
        .get { background: #3182ce; color: white; }
        .put { background: #d69e2e; color: white; }
        .patch { background: #805ad5; color: white; }
        .delete { background: #e53e3e; color: white; }
        code {
            background: #2d3748;
            color: #f7fafc;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        pre {
            background: #2d3748;
            color: #f7fafc;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
            margin: 1rem 0;
        }
        .note {
            background: #fef5e7;
            border-left: 4px solid #d69e2e;
            padding: 1rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>yadmanx Enrollment Service</h1>
        <p>API Documentation v1.0.0</p>
    </div>

    <div class="container">
        <div class="section">
            <h2>Overview</h2>
            <p>The Enrollment Service handles the complete enrollment workflow for yadmanx, including customer management, enrollment tracking, billing data (encrypted), beneficiaries, and dynamic step data.</p>
            <p><strong>Base URL:</strong> <code>http://localhost:3002/api/v1</code></p>
        </div>

        <div class="section">
            <h2>Authentication</h2>
            <p>Currently using stubbed authentication. Include agent ID in header:</p>
            <pre>x-agent-id: 11111111-1111-1111-1111-111111111111</pre>
            <div class="note">
                <strong>Note:</strong> JWT authentication will be implemented in a future release.
            </div>
        </div>

        <div class="section">
            <h2>Enrollment Management</h2>

            <div class="endpoint">
                <h3><span class="method post">POST</span> /enrollments</h3>
                <p>Create new enrollment</p>
                <pre>{
  "customer": {
    "cin": "CIN123456",
    "first_name": "John",
    "last_name": "Doe",
    "date_of_birth": "1985-01-15",
    "email": "john@example.com",
    "phone": "555-0100",
    "address": {
      "street": "123 Main St",
      "city": "New York",
      "state": "NY",
      "zip": "10001"
    }
  },
  "plan_id": "plan-001",
  "effective_date": "2025-11-01"
}</pre>
            </div>

            <div class="endpoint">
                <h3><span class="method get">GET</span> /enrollments/:id</h3>
                <p>Get enrollment details by ID</p>
            </div>

            <div class="endpoint">
                <h3><span class="method get">GET</span> /enrollments</h3>
                <p>List enrollments with filters</p>
                <p><strong>Query Parameters:</strong> agentId, status, customerId, limit, offset</p>
            </div>

            <div class="endpoint">
                <h3><span class="method patch">PATCH</span> /enrollments/:id/status</h3>
                <p>Update enrollment status</p>
                <pre>{
  "status": "in_progress",
  "metadata": {
    "note": "Updated status"
  }
}</pre>
            </div>

            <div class="endpoint">
                <h3><span class="method delete">DELETE</span> /enrollments/:id</h3>
                <p>Cancel enrollment (sets status to cancelled)</p>
            </div>
        </div>

        <div class="section">
            <h2>Step Management</h2>

            <div class="endpoint">
                <h3><span class="method post">POST</span> /enrollments/:id/steps/:stepId</h3>
                <p>Save step data</p>
                <pre>{
  "verified": true,
  "verification_date": "2025-09-30T10:00:00Z"
}</pre>
            </div>

            <div class="endpoint">
                <h3><span class="method get">GET</span> /enrollments/:id/steps/:stepId</h3>
                <p>Get step data for a specific step</p>
            </div>

            <div class="endpoint">
                <h3><span class="method get">GET</span> /enrollments/:id/steps</h3>
                <p>Get all step data for enrollment</p>
            </div>
        </div>

        <div class="section">
            <h2>Billing</h2>

            <div class="endpoint">
                <h3><span class="method post">POST</span> /enrollments/:id/billing</h3>
                <p>Save billing data (payment data is encrypted)</p>
                <pre>{
  "contribution_amount": 150.00,
  "contribution_frequency": "monthly",
  "payment_method_type": "credit_card",
  "payment_method_last_four": "4242",
  "payment_method_expiry": "12/27",
  "payment_method_data": {
    "card_number": "4242-4242-4242-4242",
    "cvv": "123"
  },
  "effective_date": "2025-11-01"
}</pre>
            </div>

            <div class="endpoint">
                <h3><span class="method get">GET</span> /enrollments/:id/billing</h3>
                <p>Get billing data (sensitive data is masked)</p>
            </div>
        </div>

        <div class="section">
            <h2>Beneficiaries</h2>

            <div class="endpoint">
                <h3><span class="method post">POST</span> /enrollments/:id/beneficiaries</h3>
                <p>Add beneficiaries (replaces existing beneficiaries)</p>
                <pre>{
  "beneficiaries": [
    {
      "type": "primary",
      "first_name": "Jane",
      "last_name": "Doe",
      "relationship": "spouse",
      "percentage": 60,
      "date_of_birth": "1987-03-20",
      "ssn": "123-45-6789",
      "address": {...},
      "display_order": 1
    },
    {
      "type": "primary",
      "first_name": "John Jr",
      "last_name": "Doe",
      "relationship": "child",
      "percentage": 40,
      "date_of_birth": "2010-05-10",
      "display_order": 2
    }
  ]
}</pre>
                <div class="note">
                    <strong>Note:</strong> Primary beneficiaries must total 100%. Contingent beneficiaries (if any) must also total 100%.
                </div>
            </div>

            <div class="endpoint">
                <h3><span class="method get">GET</span> /enrollments/:id/beneficiaries</h3>
                <p>Get all beneficiaries for enrollment</p>
            </div>

            <div class="endpoint">
                <h3><span class="method put">PUT</span> /enrollments/:id/beneficiaries/:beneficiaryId</h3>
                <p>Update specific beneficiary</p>
            </div>

            <div class="endpoint">
                <h3><span class="method delete">DELETE</span> /enrollments/:id/beneficiaries/:beneficiaryId</h3>
                <p>Remove beneficiary</p>
            </div>
        </div>

        <div class="section">
            <h2>Summary & Submission</h2>

            <div class="endpoint">
                <h3><span class="method get">GET</span> /enrollments/:id/summary</h3>
                <p>Get complete enrollment summary including enrollment, billing, beneficiaries, and steps</p>
            </div>

            <div class="endpoint">
                <h3><span class="method post">POST</span> /enrollments/:id/submit</h3>
                <p>Submit enrollment for processing</p>
                <div class="note">
                    <strong>Required:</strong> Enrollment must have status "in_progress" and all required steps completed.
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Enrollment Statuses</h2>
            <ul>
                <li><strong>draft:</strong> Initial state</li>
                <li><strong>in_progress:</strong> Enrollment is being completed</li>
                <li><strong>submitted:</strong> Submitted for processing</li>
                <li><strong>approved:</strong> Enrollment approved</li>
                <li><strong>rejected:</strong> Enrollment rejected</li>
                <li><strong>cancelled:</strong> Enrollment cancelled</li>
            </ul>
        </div>

        <div class="section">
            <h2>Error Responses</h2>
            <p>All errors follow this format:</p>
            <pre>{
  "error": "Error message here",
  "stack": "Stack trace (development only)"
}</pre>
            <p><strong>Common Status Codes:</strong></p>
            <ul>
                <li><code>200</code> - Success</li>
                <li><code>201</code> - Created</li>
                <li><code>400</code> - Bad Request</li>
                <li><code>404</code> - Not Found</li>
                <li><code>500</code> - Internal Server Error</li>
            </ul>
        </div>
    </div>
</body>
</html>